#!/usr/bin/env sh

set -e

if [ $(which docker || false) ]; then
    readonly PROJECT_DIRECTORY=$(realpath $(dirname $(realpath $0))/..)
    docker run \
        --rm \
        -e PHPCS_BOOTSTRAP=/var/phpcs.bootstrap.php \
        -v ${PROJECT_DIRECTORY}:/var/phpcs:ro \
        --entrypoint=/var/phpcs/bin/phpcs \
        steevanb/php-code-sniffs:3.0.0
else
    php -d memory_limit=512M /var/steevanb/php-code-sniffs/vendor/bin/phpcs \
        --warning-severity=0 \
        --ignore=/var/phpcs/vendor/,/var/phpcs/public/phpinfo.php,/var/phpcs/benchmark/statistics.php \
        --standard=/var/steevanb/php-code-sniffs/vendor/steevanb/php-code-sniffs/Steevanb/ruleset.xml \
        --bootstrap=/var/phpcs/phpcs.bootstrap.php \
        --report=steevanb\\PhpCodeSniffs\\Reports\\Steevanb \
        /var/phpcs/
fi
